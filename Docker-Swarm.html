base=https://github.com/docker/machine/releases/download/v0.16.0 &&  curl -L $base/docker-machine-$(uname -s)-$(uname -m) >/tmp/docker-machine &&  sudo install /tmp/docker-machine /usr/local/bin/docker-machine


curl -L https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-`uname -s`-`uname -m` >/opt/docker-machine/docker-machine &&
chmod +x /tmp/docker-machine &&
sudo cp /tmp/docker-machine /usr/local/bin/docker-machine



curl -L https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-`uname -s`-`uname -m` >/tmp/docker-machine

sudo -s
curl -L https://github.com/docker/machine/releases/download/v0.7.0/docker-machine-`uname -s`-`uname -m` >/usr/local/bin/docker-machine && \
  chmod +x /usr/local/bin/docker-machine



===========================================


[root@ip-172-31-26-214 opt]# mkdir /opt/docker-machine
[root@ip-172-31-26-214 opt]# curl -L https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-`uname -s`-`uname -m` >/opt/docker-machine
bash: /opt/docker-machine: Is a directory
[root@ip-172-31-26-214 opt]# curl -L https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-`uname -s`-`uname -m` >/opt/docker-machine/docker-machine
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   617    0   617    0     0    607      0 --:--:--  0:00:01 --:--:--   608
100 26.8M  100 26.8M    0     0  4433k      0  0:00:06  0:00:06 --:--:-- 5974k
[root@ip-172-31-26-214 opt]# pwd
/opt
[root@ip-172-31-26-214 opt]# ls -lrt
total 12
drwxr-xr-x 5 root root 4096 Nov 16 23:06 aws
drwxrwxrwx 2 root root 4096 Dec 19 15:26 ag1
drwxr-xr-x 2 root root 4096 Dec 19 16:14 docker-machine
[root@ip-172-31-26-214 opt]# cd docker-machine/
[root@ip-172-31-26-214 docker-machine]# ls -lrt
total 27504
-rw-r--r-- 1 root root 28160480 Dec 19 16:14 docker-machine
[root@ip-172-31-26-214 docker-machine]# chmod 777 /opt/docker-machine/docker-machine
[root@ip-172-31-26-214 docker-machine]# ln -s /opt/docker-machine/docker-machine ^C
[root@ip-172-31-26-214 docker-machine]# cd /bin

[root@ip-172-31-26-214 bin]# cd -
/opt/docker-machine
[root@ip-172-31-26-214 docker-machine]# pwd
/opt/docker-machine
[root@ip-172-31-26-214 docker-machine]# ln -s /opt/docker-machine/docker-machine /bin/docker-machine
[root@ip-172-31-26-214 docker-machine]# docker-machine v
docker-machine: 'v' is not a docker-machine command. See 'docker-machine --help'.
[root@ip-172-31-26-214 docker-machine]# docker-machine version
docker-machine version 0.15.0, build b48dc28d
[root@ip-172-31-26-214 docker-machine]#



docker-machine create --driver virtualbox Instance-1

[root@ip-172-31-26-214 docker-machine]# docker swarm init --advertise-addr eth0
Swarm initialized: current node (ve2h0gwjm8f8hl1b7v8hy23h2) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-2gcrlej4g625rgxlgqg0lws429t6jqhcbx8x1musrqdar5kqka-a2n1pcaugfdplqwps9uey0gdl 172.31.26.214:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

[root@ip-172-31-26-214 docker-machine]#



[root@ip-172-31-29-153 ec2-user]# history
    1  sudo yum update -y
    2  sudo yum install -y docker
    3  sudo service docker start
    4  sudo usermod -a -G docker ec2-user
    5  sudo yum install -y git
    6  docker info
    7  mkdir /opt/docker-machine
    8  curl -L https://github.com/docker/machine/releases/download/v0.15.0/docker-machine-`uname -s`-`uname -m` >/opt/docker-machine/docker-machine
    9  docker-machine
   10  chmod 777 /opt/docker-machine/docker-machine
   11  ln -s /opt/docker-machine/docker-machine
   12  ln -s /opt/docker-machine/docker-machine /bin/docker-machine
   13  docker-machine v
   14  docker-machine version
   15  docker swarm join --token SWMTKN-1-2gcrlej4g625rgxlgqg0lws429t6jqhcbx8x1musrqdar5kqka-a2n1pcaugfdplqwps9uey0gdl 172.31.26.214:2377
   16  service docker restart
   17  docker swarm join --token SWMTKN-1-2gcrlej4g625rgxlgqg0lws429t6jqhcbx8x1musrqdar5kqka-a2n1pcaugfdplqwps9uey0gdl 172.31.26.214:2377
   18  history
[root@ip-172-31-29-153 ec2-user]#





 docker swarm init --advertise-addr eth0
172.31.18.165
Swarm initialized: current node (tcv4yssavcf6gldtwpph59m7s) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-3rbyd736lqef4tui091ai0nftrj23y31px2mnjx1trn2510j43-4epvrrrylrfwky4fggukuvuse 172.31.26.214:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

[root@ip-172-31-26-214 /]#

[root@ip-172-31-18-165 ec2-user]# docker swarm leave --force
Node left the swarm.




[root@ip-172-31-18-165 ec2-user]#  docker swarm init --advertise-addr 172.31.29.153:2377
Swarm initialized: current node (nf9peprim03ciepxpbcgrqowu) is now a manager.

To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-19y2ck9u7gfwcyugz5nxiiwk121mow9pbno7sdsnhe3qibeygi-9udjeqvxk66glpswe49zr0utv 172.31.18.165:2377

To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.

[root@ip-172-31-18-165 ec2-user]# docker info


Error response from daemon: This node is already part of a swarm. Use "docker swarm leave" to leave this swarm and join another one.
[root@ip-172-31-18-165 ~]# docker swarm leave --force
Node left the swarm.
[root@ip-172-31-18-165 ~]#  docker swarm join --token SWMTKN-1-4mfey46f5auy5g5bg0quihar55h68bnd5gzznoucljfj2y3hvm-32o33sc33jpscw5pog5kmkmaz 172.31.29.153:2377
This node joined a swarm as a worker.
[root@ip-172-31-18-165 ~]#

docker swarm join --token SWMTKN-1-4mfey46f5auy5g5bg0quihar55h68bnd5gzznoucljfj2y3hvm-32o33sc33jpscw5pog5kmkmaz 172.31.29.153:2377 join-token manager

docker swarm join join-token manager

[root@ip-172-31-29-153 ec2-user]# docker swarm join-token worker
To add a worker to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-4mfey46f5auy5g5bg0quihar55h68bnd5gzznoucljfj2y3hvm-32o33sc33jpscw5pog5kmkmaz 172.31.29.153:2377

[root@ip-172-31-29-153 ec2-user]# docker swarm join-token manager
To add a manager to this swarm, run the following command:

    docker swarm join --token SWMTKN-1-4mfey46f5auy5g5bg0quihar55h68bnd5gzznoucljfj2y3hvm-d6rw4hlysg95rz128mrop8sag 172.31.29.153:2377

[root@ip-172-31-29-153 ec2-user]#



[root@ip-172-31-29-153 ~]# docker-machine ls
NAME   ACTIVE   DRIVER   STATE   URL   SWARM   DOCKER   ERRORS
[root@ip-172-31-29-153 ~]# docker node ls
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
c90xq0i30ozq0x231xjv174nx     ip-172-31-18-165    Ready               Active                                  18.06.1-ce
uzdn1iav7qylpesz888yoqk66     ip-172-31-26-214    Ready               Active                                  18.06.1-ce
xeclvp791iwivfkg3auheqlsa *   ip-172-31-29-153    Ready               Active              Leader              18.06.1-ce
[root@ip-172-31-29-153 ~]#

docker service create --replicas 3 -p 88:80 --name web1 nginx


================================

[root@ip-172-31-29-153 ec2-user]# docker node ls
ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION
c90xq0i30ozq0x231xjv174nx     ip-172-31-18-165    Ready               Active                                  18.06.1-ce
uzdn1iav7qylpesz888yoqk66     ip-172-31-26-214    Ready               Active                                  18.06.1-ce
xeclvp791iwivfkg3auheqlsa *   ip-172-31-29-153    Ready               Active              Leader              18.06.1-ce
[root@ip-172-31-29-153 ec2-user]# docker service create --replicas 3 -p 88:80 --name web1 nginx
bv836wv4uiah4od31zajwk9i0
overall progress: 3 out of 3 tasks
1/3: running   [==================================================>]
2/3: running   [==================================================>]
3/3: running   [==================================================>]
verify: Service converged
[root@ip-172-31-29-153 ec2-user]# docker service ls
ID                  NAME                MODE                REPLICAS            IMAGE               PORTS
bv836wv4uiah        serviceName         replicated          3/3                 nginx:latest        *:88->80/tcp
[root@ip-172-31-29-153 ec2-user]# docker service ls serviceName
"docker service ls" accepts no arguments.
See 'docker service ls --help'.

Usage:  docker service ls [OPTIONS]

List services
[root@ip-172-31-29-153 ec2-user]#  docker service ps serviceName
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE           ERROR               PORTS
lbpxhiregfah        serviceName.1       nginx:latest        ip-172-31-18-165    Running             Running 3 minutes ago
jyrqglsagd85        serviceName.2       nginx:latest        ip-172-31-26-214    Running             Running 3 minutes ago
fuibu62nejjz        serviceName.3       nginx:latest        ip-172-31-29-153    Running             Running 3 minutes ago
[root@ip-172-31-29-153 ec2-user]# docker service scale serviceName=4
serviceName scaled to 4
overall progress: 4 out of 4 tasks
1/4: running   [==================================================>]
2/4: running   [==================================================>]
3/4: running   [==================================================>]
4/4: running   [==================================================>]
verify: Service converged
[root@ip-172-31-29-153 ec2-user]# docker service ps serviceName
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
lbpxhiregfah        serviceName.1       nginx:latest        ip-172-31-18-165    Running             Running 8 minutes ago
jyrqglsagd85        serviceName.2       nginx:latest        ip-172-31-26-214    Running             Running 8 minutes ago
fuibu62nejjz        serviceName.3       nginx:latest        ip-172-31-29-153    Running             Running 8 minutes ago
87fgyit7o700        serviceName.4       nginx:latest        ip-172-31-29-153    Running             Running 15 seconds ago
[root@ip-172-31-29-153 ec2-user]# docker service scale serviceName=5
serviceName scaled to 5
overall progress: 5 out of 5 tasks
1/5: running   [==================================================>]
2/5: running   [==================================================>]
3/5: running   [==================================================>]
4/5: running   [==================================================>]
5/5: running   [==================================================>]
verify: Service converged
[root@ip-172-31-29-153 ec2-user]# docker service ps serviceName
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
lbpxhiregfah        serviceName.1       nginx:latest        ip-172-31-18-165    Running             Running 8 minutes ago
jyrqglsagd85        serviceName.2       nginx:latest        ip-172-31-26-214    Running             Running 8 minutes ago
fuibu62nejjz        serviceName.3       nginx:latest        ip-172-31-29-153    Running             Running 8 minutes ago
87fgyit7o700        serviceName.4       nginx:latest        ip-172-31-29-153    Running             Running 50 seconds ago
ifryvsrf9sol        serviceName.5       nginx:latest        ip-172-31-18-165    Running             Running 11 seconds ago
[root@ip-172-31-29-153 ec2-user]#


[root@ip-172-31-29-153 ec2-user]# docker service scale serviceName=2
serviceName scaled to 2
overall progress: 2 out of 2 tasks
1/2: running   [==================================================>]
2/2: running   [==================================================>]
verify: Service converged
[root@ip-172-31-29-153 ec2-user]# docker service ps serviceName
ID                  NAME                IMAGE               NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS
lbpxhiregfah        serviceName.1       nginx:latest        ip-172-31-18-165    Running             Running 11 minutes ago
jyrqglsagd85        serviceName.2       nginx:latest        ip-172-31-26-214    Running             Running 11 minutes ago
[root@ip-172-31-29-153 ec2-user]#
[root@ip-172-31-29-153 ec2-user]# docker node inspect ip-172-31-26-214
[
    {
        "ID": "uzdn1iav7qylpesz888yoqk66",
        "Version": {
            "Index": 20
 "Labels": {},
            "Role": "worker",
            "Availability": "active"
 "Status": {
            "State": "ready",
            "Addr": "172.31.26.214"
        }



[root@ip-172-31-29-153 ec2-user]# docker service rm serviceName
serviceName




docker node demote <node name>
docker node promote NODE
